# Karma

### За всем не уследишь
###### [кто-то очень умный, что-то типа пинки и брейна, мб шелдон]

Разработка своего стека различных переиспользуемых между проектами вещей – процесс очень реактивный. И при фиксе багов и реализации новых фич держать в уме все возможные сценарии использования контрола/партиала во всех более-менее активных проектах просто невозможно.

### Тестирование

В принципе, решение проблемы вполне очевидно – тестирование. Однако, Front-End разработчики часто пренебрегают тестированием.

### Тестировать нужно все

Тестировать можно и нужно все, что вы переиспользуете. Мы стараемся тестировать все:
* свои stylus-функции
* переиспользуемые кусочки верстки (они обычно конфигурируемые)
* переиспользуемые хелперы верстки
* библиотчечные код
* внутрикорпаративные контролы/виджеты (это отдельная головная боль)

*Кто из присутствующих тестирует что-нибудь из front-end ресурсов? А кто тестирует пользовательское взаимодействие?*

### Головная боль
И если с тестированием простых front-end ресурсов (partials, stylus-функции) все просто – пропустили через различные процессоры свой код и сравнили результат с ожидаемым, то тестирование клиентского JS – отдельная головная боль.

### Старый подход

Тестировать клиентский код можно давно, есть огромное количество фреймворков для тестирования JS-кода. Однако, к стандартному оверходу `TDD` подхода добавляются все прелести клиентской разработки. Итак, если по шагам:

1. Нужно завести spec - файл (тупо HTML-документ)
2. Регистрировать в нем все файлы тестов
3. Открыть spec - файл во всех целевых браузерах
4. И на каждое изменение кода рефрешить все свои браузеры
 
### Такой TDD нам не нужен
В общем, неудивительно, что фронтенд разработчики очень нехотя тестируют свой код.
А если и тестируют, то в основном только различный библиотечный код (простые unit-тесты).
Намного реже тестируют пользовательское взаимодействие, и при каждом изменении поведения контрола разработчик берет и прокликивает/проскролливает/протаскивает во всех браузерах контрол.
И опять мы приходим к проблеме, что за всеми этими танцами с бубнами вокруг тестов очень легко сбиться с мысли и забыть, что ты вообще хотел написать.
В общем, тестированию клиентских ресурсов нужен свой супергерой.

### Отзывчивость тестов

Для нас таким супер героем стал test-runner `Karma`. Самая главная идея, которую заложили в этот проект ребята из гугла, заключается в том, что тесты должны давать моментальный фидбек и не требовать постоянной пляски с подключением файлов и рефрешем браузеров.

### Свобода выбора

`Karma` – это просто test-runner, который работает под `nodejs`. Он никак не ограничивает вас в выборе тестового фреймворка или используемых технологиях. Главное – ТЕСТИРУЙ и будь продуктивней.

### Чудеса
###### [кто-то в центре внимания]

Достаточно выполнить простейшую настройку тестового окружения и `Karma` сама будет запускать все необходимые ВАМ браузеры. Подключать ВАШ любимый тестовый фреймворк. Следить за изменением в ВАШИХ файлах (исходниках и тестов). Перезапускать тесты во всех открытых браузерах. И сообщать ВАМ в удобной для ВАС форме результаты.

### Тестирование пользовательского взаимодействия

Вроде весь головняк сняли кроме одного: тестирование пользовательского взаимодействия.
Тут явно не обойтись без толпы тестировщиков. Бесспорно, тестировщики очень хорошо проверят все узкие места и найдут все баги (даже те, которые клиент никогда не увидит). Но этот тип тестирования все равно остается узким местом, которое тормозит суперпродуктивный процесс внедрения новых фич и фикс багов. Хотя казалось бы, пользовательское взаимодействие – это то же самое API вашего контрольчика/виджета.

### ng-scenario - норм
###### [из пушки по воробьям]
В общем, здесь тоже нужен свой супергерой.
Selenium – это все равно, что стрелять из пушки по воробьям, этим пусть лучше занимаются тестировщики.
Нам вполне хватает `ng-scenario`, который очень просто и легко позволяет писать простейшие сценарии пользовательского взаимодействия. Так же DSL, который предоставляет ng-senario, довольно легко расширяется новыми пользовательскими событиями.

### Послесловие

Поначалу очень сложно отказаться от прокликивания своих контролов и довериться бездушной машине. Однако, спустя пару дней `TDD` разработки перестаешь скучать по всем раздражающим операциям, начинаешь более тестируемо писать код, грамотней разбивая его на функциональные составляющие.
Можно с уверенностью утверждать, что тестировать клиентский код сейчас можно с чистой совестью, не переживая за слишком большой оверхед, связанный с поддержанием тестового окружения.

