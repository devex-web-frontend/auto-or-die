# Karma

### Совместимость
###### [кто-то очень умный, что-то типа пинки и брейна, мб шелдон]

Разработка своего стека различных переиспользуемых между проектами вещей – процесс очень реактивный. И при фиксе багов и реализации новых фич очень сложно следить за совместимостью. Держать в уме все возможные сценарии использования контрола/партиала во всех более-менее активных проектах невозможно. Конечно если вы не обладаете эйдетической памятью. Однако есть более генетически простой способ решить задачу - тестирование.

### Тестирование

Что же нужно тестировать? Тестировать нужно все что можно протестировать. Переиспользуемые между проектами dev-зависимости тестировать нужно в обязательном порядке.

### Тестировать нужно все

Тестировать можно и нужно все, что вы переиспользуете. Мы стараемся тестировать все.

### Тестированние dev-зависимостей

С тестированием простых полустатических front-end ресурсов (partials, helpers, stylus (функции, миксины)) все довльно просто. Запихиваем все файлики в перпроцессор (stylus, assemble или Handlebars.compile). И сравниваем получившийся результат с ожидаемым.

### Тестирвоание prod-зависимостей
Prod-зависимости можно условно разделить на два типа:
* библиотечный код, который отлично покрывается unit-тестами
* код которые активно взаимодействует с пользователем, покрывается end2end тестами

### Unit-тестирование

Тестировать клиентский код можно давно, есть огромное количество фреймворков для тестирования JS-кода. Однако, к стандартному оверходу `TDD` подхода добавляются все прелести клиентской разработки. Итак, если по шагам:

1. Нужно завести spec - файл (тупо HTML-документ)
2. Регистрировать в нем все файлы тестов
3. Открыть spec - файл во всех целевых браузерах
4. И на каждое изменение кода рефрешить все свои браузеры
 
### Такой TDD нам не нужен
В общем, неудивительно, что фронтенд разработчики очень нехотя тестируют свой код. За всеми этими танцами с бубнами вокруг тестов очень легко сбиться с мысли и забыть, что ты вообще хотел написать.
В общем, тестированию клиентских ресурсов нужен свой супергерой.

### Karma

Для нас таким супер героем стал test-runner `Karma`. 
### Быстрый фидбек
Самая главная идея, которую заложили в этот проект ребята из гугла, заключается в том, что тесты должны давать моментальный фидбек и не требовать постоянной пляски с подключением файлов и рефрешем браузеров.

### Важные моменты

`Karma` – это просто test-runner, который работает под `nodejs`. Он никак не ограничивает вас в выборе тестового фреймворка или используемых технологиях. Главное – ТЕСТИРУЙ и будь продуктивней.

Достаточно выполнить простейшую настройку тестового окружения и `Karma` сама будет запускать все необходимые ВАМ браузеры. Подключать ВАШ любимый тестовый фреймворк. Следить за изменением в ВАШИХ файлах (исходниках и тестов). Перезапускать тесты во всех открытых браузерах. И сообщать ВАМ в удобной для ВАС форме результаты.

### Тестирование пользовательского взаимодействия

Вроде весь головняк сняли кроме одного: тестирование пользовательского взаимодействия или end2end тесты.
Разработка кода который активно взаимодействет с пользователем превращается в издевательство над кнопкой f5.
Такое тестирование тормозит суперпродуктивный процесс внедрения новых фич и фикс багов. 

### Пользовательские события это тоже API

Пользовательские событя это такоеже API, просто его не уобно тестировать, но и тут у кармы было готовое решение.

### ng-scenario
###### [из пушки по воробьям]

Selenium – это все равно, что стрелять из пушки по воробьям, этим пусть лучше занимаются тестировщики.
Нам вполне хватает `ng-scenario`, который
* очень просто и легко позволяет писать простейшие сценарии пользовательского взаимодействия.
* Имеет строгий DSL, который е дает скатится в unit-тестирование e2e-инструментами
* Иммет довольно просто механизм расширения DSL (но нужно пользоваться с остарожностью)

### Послесловие

Поначалу очень сложно отказаться от прокликивания своих контролов и довериться бездушной машине. Однако, спустя пару дней `TDD` разработки перестаешь скучать по всем раздражающим операциям, начинаешь более тестируемо писать код, грамотней разбивая его на функциональные составляющие.
Можно с уверенностью утверждать, что тестировать клиентский код сейчас можно с чистой совестью, не переживая за слишком большой оверхед, связанный с поддержанием тестового окружения.

